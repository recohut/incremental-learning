
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Avalanche Visual Incremental Learning &#8212; incremental-learning</title>
    
  <link href="_static/css/theme.css" rel="stylesheet" />
  <link href="_static/css/index.c5995385ac14fb8791e8eb36b4908be2.css" rel="stylesheet" />

    
  <link rel="stylesheet"
    href="_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-book-theme.css?digest=c3fdc42140077d1ad13ad2f1588a4309" />
    <link rel="stylesheet" type="text/css" href="_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" />
    <link rel="stylesheet" type="text/css" href="_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" />
    
  <link rel="preload" as="script" href="_static/js/index.1c5a1a01449ed65a7b51.js">

    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script src="_static/togglebutton.js"></script>
    <script src="_static/clipboard.min.js"></script>
    <script src="_static/copybutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="_static/sphinx-book-theme.12a9622fbb08dcb3a2a40b2c02b83a57.js"></script>
    <script async="async" src="https://unpkg.com/thebe@0.5.1/lib/index.js"></script>
    <script>
        const thebe_selector = ".thebe,.cell"
        const thebe_selector_input = "pre,.cell_input div.highlight"
        const thebe_selector_output = ".output,.cell_output"
    </script>
    <script async="async" src="_static/sphinx-thebe.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Lambda Learner for Incremental Learning using GLMix models" href="T392297_Lambda_Learner_for_Incremental_Learning_using_GLMix_models.html" />
    <link rel="prev" title="Incremental Stochastic Gradient Descent" href="T664430_Incremental_Stochastic_Gradient_Descent.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<div class="col-12 col-md-3 bd-sidebar site-navigation show" id="site-navigation">
    
        <div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="index.html">
      
      
      
      <h1 class="site-logo" id="site-title">incremental-learning</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="L521041_Incremental_Learning.html">
   Incremental Learning
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Concepts
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="L194114_Concept_Drift.html">
   Concept Drift
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L589394_Jensen%E2%80%93Shannon_divergence.html">
   Jensen–Shannon divergence
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L241645_A_spectrum_of_model_freshness.html">
   A spectrum of model freshness
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L883094_Incremental_Learning_in_Computer_Vision.html">
   Incremental Learning in Computer Vision
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L369117_Incremental_Learning_in_Recommender_Systems.html">
   Incremental Learning in Recommender Systems
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L725007_River.html">
   River
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L595800_Lambda_Learner.html">
   Lambda Learner
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L305905_Scikit_warm_start.html">
   Scikit warm-start
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Models
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="L498804_GLMix.html">
   GLMix
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L832818_IncCTR.html">
   IncCTR
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L753817_SML.html">
   SML
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L395827_CIGC.html">
   CIGC
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L958254_GraphSAIL.html">
   GraphSAIL
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L926913_NMRN.html">
   NMRN
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L766388_RKMF.html">
   RKMF
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Cases
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="L967738_MarketCloud.html">
   MarketCloud
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L593489_Huawei_AppGallery_Candidate_Selection_for_App_Recommendation.html">
   Huawei AppGallery Candidate Selection for App Recommendation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="L576956_GLMix_in_LinkedIn_Job_Recommendation.html">
   GLMix in LinkedIn Job Recommendation
  </a>
 </li>
</ul>
<p class="caption" role="heading">
 <span class="caption-text">
  Tutorials
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="T063084_Scikit_Multiflow.html">
   Scikit Multiflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T578427_Dask_Incremental_Wrapper.html">
   Dask Incremental Wrapper
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T613575_Warm_start_Model_Retraining.html">
   Warm-start Model Retraining
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T502860_Drift_Detection_using_River_library.html">
   Drift Detection using River library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T664430_Incremental_Stochastic_Gradient_Descent.html">
   Incremental Stochastic Gradient Descent
  </a>
 </li>
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Avalanche Visual Incremental Learning
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T392297_Lambda_Learner_for_Incremental_Learning_using_GLMix_models.html">
   Lambda Learner for Incremental Learning using GLMix models
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T007121_FlowRec.html">
   FlowRec
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T012987_Incremental_Matrix_Factorization_on_ML_100k_using_River_library.html">
   Incremental Matrix Factorization on ML-100k using River library
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T406689_Kernelized_Matrix_Factorization_on_ML_1m.html">
   Kernelized Matrix Factorization on ML-1m
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T993858_Incremental_Collaborative_Filtering.html">
   Incremental Collaborative Filtering
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="T063788_Neural_Memory_Streaming_Recommender_Networks_with_Adversarial_Training.html">
   Neural Memory Streaming Recommender Networks with Adversarial Training
  </a>
 </li>
</ul>

    </div>
</nav> <!-- To handle the deprecated key -->

<div class="navbar_extra_footer">
  Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
</div>

</div>


          


          
<main class="col py-md-3 pl-md-4 bd-content overflow-auto" role="main">
    
    <div class="topbar container-xl fixed-top">
    <div class="topbar-contents row">
        <div class="col-12 col-md-3 bd-topbar-whitespace site-navigation show"></div>
        <div class="col pl-md-4 topbar-main">
            
            <button id="navbar-toggler" class="navbar-toggler ml-0" type="button" data-toggle="collapse"
                data-toggle="tooltip" data-placement="bottom" data-target=".site-navigation" aria-controls="navbar-menu"
                aria-expanded="true" aria-label="Toggle navigation" aria-controls="site-navigation"
                title="Toggle navigation" data-toggle="tooltip" data-placement="left">
                <i class="fas fa-bars"></i>
                <i class="fas fa-arrow-left"></i>
                <i class="fas fa-arrow-up"></i>
            </button>
            
            
<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn" aria-label="Download this page"><i
            class="fas fa-download"></i></button>

    <div class="dropdown-buttons">
        <!-- ipynb file if we had a myst markdown file -->
        
        <!-- Download raw file -->
        <a class="dropdown-buttons" href="_sources/T860884_Avalanche_Visual_Incremental_Learning.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Download source file" data-toggle="tooltip"
                data-placement="left">.ipynb</button></a>
        <!-- Download PDF via print -->
        <button type="button" id="download-print" class="btn btn-secondary topbarbtn" title="Print to PDF"
            onClick="window.print()" data-toggle="tooltip" data-placement="left">.pdf</button>
    </div>
</div>

            <!-- Source interaction buttons -->

            <!-- Full screen (wrap in <a> to have style consistency -->

<a class="full-screen-button"><button type="button" class="btn btn-secondary topbarbtn" data-toggle="tooltip"
        data-placement="bottom" onclick="toggleFullScreen()" aria-label="Fullscreen mode"
        title="Fullscreen mode"><i
            class="fas fa-expand"></i></button></a>

            <!-- Launch buttons -->

<div class="dropdown-buttons-trigger">
    <button id="dropdown-buttons-trigger" class="btn btn-secondary topbarbtn"
        aria-label="Launch interactive content"><i class="fas fa-rocket"></i></button>
    <div class="dropdown-buttons">
        
        <a class="binder-button" href="https://mybinder.org/v2/gh/sparsh-ai/incremental-learning/main?urlpath=tree/docs/T860884_Avalanche_Visual_Incremental_Learning.ipynb"><button type="button"
                class="btn btn-secondary topbarbtn" title="Launch Binder" data-toggle="tooltip"
                data-placement="left"><img class="binder-button-logo"
                    src="_static/images/logo_binder.svg"
                    alt="Interact on binder">Binder</button></a>
        
        
        
        <a class="colab-button" href="https://colab.research.google.com/github/sparsh-ai/incremental-learning/blob/main/docs/T860884_Avalanche_Visual_Incremental_Learning.ipynb"><button type="button" class="btn btn-secondary topbarbtn"
                title="Launch Colab" data-toggle="tooltip" data-placement="left"><img class="colab-button-logo"
                    src="_static/images/logo_colab.png"
                    alt="Interact on Colab">Colab</button></a>
        
        <button type="button" class="btn btn-secondary topbarbtn"
            onclick="initThebeSBT()" title="Launch Thebe" data-toggle="tooltip" data-placement="left"><i
                class="fas fa-play"></i><span style="margin-left: .4em;">Live Code</span></button>
        
    </div>
</div>

        </div>

        <!-- Table of contents -->
        <div class="d-none d-md-block col-md-2 bd-toc show">
            
            <div class="tocsection onthispage pt-5 pb-3">
                <i class="fas fa-list"></i> Contents
            </div>
            <nav id="bd-toc-nav" aria-label="Page">
                <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#setup">
   Setup
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#a-comprehensive-example">
   A comprehensive example
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#dataloading-memory-buffers-and-replay">
   Dataloading, Memory Buffers, and Replay
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#dataloaders">
     Dataloaders
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#memory-buffers">
     Memory Buffers
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#replay-plugins">
     Replay Plugins
    </a>
   </li>
  </ul>
 </li>
</ul>

            </nav>
        </div>
    </div>
</div>
    <div id="main-content" class="row">
        <div class="col-12 col-md-9 pl-md-3 pr-md-0">
        
              <div>
                
  <div class="tex2jax_ignore mathjax_ignore section" id="avalanche-visual-incremental-learning">
<h1>Avalanche Visual Incremental Learning<a class="headerlink" href="#avalanche-visual-incremental-learning" title="Permalink to this headline">¶</a></h1>
<div class="section" id="setup">
<h2>Setup<a class="headerlink" href="#setup" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>!pip install git+https://github.com/ContinualAI/avalanche.git
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">torch</span>
<span class="kn">from</span> <span class="nn">torch.optim</span> <span class="kn">import</span> <span class="n">SGD</span>
<span class="kn">from</span> <span class="nn">torch.nn</span> <span class="kn">import</span> <span class="n">CrossEntropyLoss</span>
<span class="kn">from</span> <span class="nn">avalanche.benchmarks.classic</span> <span class="kn">import</span> <span class="n">SplitMNIST</span>
<span class="kn">from</span> <span class="nn">avalanche.evaluation.metrics</span> <span class="kn">import</span> <span class="n">forgetting_metrics</span><span class="p">,</span> <span class="n">accuracy_metrics</span><span class="p">,</span> \
    <span class="n">loss_metrics</span><span class="p">,</span> <span class="n">timing_metrics</span><span class="p">,</span> <span class="n">cpu_usage_metrics</span><span class="p">,</span> <span class="n">confusion_matrix_metrics</span><span class="p">,</span> <span class="n">disk_usage_metrics</span>
<span class="kn">from</span> <span class="nn">avalanche.models</span> <span class="kn">import</span> <span class="n">SimpleMLP</span>
<span class="kn">from</span> <span class="nn">avalanche.logging</span> <span class="kn">import</span> <span class="n">InteractiveLogger</span><span class="p">,</span> <span class="n">TextLogger</span><span class="p">,</span> <span class="n">TensorboardLogger</span>
<span class="kn">from</span> <span class="nn">avalanche.training.plugins</span> <span class="kn">import</span> <span class="n">EvaluationPlugin</span>
<span class="kn">from</span> <span class="nn">avalanche.training.strategies</span> <span class="kn">import</span> <span class="n">Naive</span>
<span class="kn">from</span> <span class="nn">avalanche.benchmarks.utils.data_loader</span> <span class="kn">import</span> <span class="n">GroupBalancedDataLoader</span>
<span class="kn">from</span> <span class="nn">avalanche.training.storage_policy</span> <span class="kn">import</span> <span class="n">ReservoirSamplingBuffer</span>
<span class="kn">from</span> <span class="nn">types</span> <span class="kn">import</span> <span class="n">SimpleNamespace</span>
<span class="kn">from</span> <span class="nn">avalanche.training.storage_policy</span> <span class="kn">import</span> <span class="n">ParametricBuffer</span><span class="p">,</span> <span class="n">RandomExemplarsSelectionStrategy</span>
<span class="kn">from</span> <span class="nn">avalanche.benchmarks.utils.data_loader</span> <span class="kn">import</span> <span class="n">ReplayDataLoader</span>
<span class="kn">from</span> <span class="nn">avalanche.training.plugins</span> <span class="kn">import</span> <span class="n">StrategyPlugin</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="a-comprehensive-example">
<h2>A comprehensive example<a class="headerlink" href="#a-comprehensive-example" title="Permalink to this headline">¶</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span> <span class="o">=</span> <span class="n">SplitMNIST</span><span class="p">(</span><span class="n">n_experiences</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># MODEL CREATION</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SimpleMLP</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="n">scenario</span><span class="o">.</span><span class="n">n_classes</span><span class="p">)</span>

<span class="c1"># DEFINE THE EVALUATION PLUGIN and LOGGERS</span>
<span class="c1"># The evaluation plugin manages the metrics computation.</span>
<span class="c1"># It takes as argument a list of metrics, collectes their results and returns</span>
<span class="c1"># them to the strategy it is attached to.</span>

<span class="c1"># log to Tensorboard</span>
<span class="n">tb_logger</span> <span class="o">=</span> <span class="n">TensorboardLogger</span><span class="p">()</span>

<span class="c1"># log to text file</span>
<span class="n">text_logger</span> <span class="o">=</span> <span class="n">TextLogger</span><span class="p">(</span><span class="nb">open</span><span class="p">(</span><span class="s1">&#39;log.txt&#39;</span><span class="p">,</span> <span class="s1">&#39;a&#39;</span><span class="p">))</span>

<span class="c1"># print to stdout</span>
<span class="n">interactive_logger</span> <span class="o">=</span> <span class="n">InteractiveLogger</span><span class="p">()</span>

<span class="n">eval_plugin</span> <span class="o">=</span> <span class="n">EvaluationPlugin</span><span class="p">(</span>
    <span class="n">accuracy_metrics</span><span class="p">(</span><span class="n">minibatch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">experience</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">loss_metrics</span><span class="p">(</span><span class="n">minibatch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">experience</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">timing_metrics</span><span class="p">(</span><span class="n">epoch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">epoch_running</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">forgetting_metrics</span><span class="p">(</span><span class="n">experience</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">cpu_usage_metrics</span><span class="p">(</span><span class="n">experience</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">confusion_matrix_metrics</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="n">scenario</span><span class="o">.</span><span class="n">n_classes</span><span class="p">,</span> <span class="n">save_image</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
                             <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">disk_usage_metrics</span><span class="p">(</span><span class="n">minibatch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">epoch</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">experience</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">loggers</span><span class="o">=</span><span class="p">[</span><span class="n">interactive_logger</span><span class="p">,</span> <span class="n">text_logger</span><span class="p">,</span> <span class="n">tb_logger</span><span class="p">]</span>
<span class="p">)</span>

<span class="c1"># CREATE THE STRATEGY INSTANCE (NAIVE)</span>
<span class="n">cl_strategy</span> <span class="o">=</span> <span class="n">Naive</span><span class="p">(</span>
    <span class="n">model</span><span class="p">,</span> <span class="n">SGD</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">,</span> <span class="n">momentum</span><span class="o">=</span><span class="mf">0.9</span><span class="p">),</span>
    <span class="n">CrossEntropyLoss</span><span class="p">(),</span> <span class="n">train_mb_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">train_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eval_mb_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
    <span class="n">evaluator</span><span class="o">=</span><span class="n">eval_plugin</span><span class="p">)</span>

<span class="c1"># TRAINING LOOP</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting experiment...&#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">experience</span> <span class="ow">in</span> <span class="n">scenario</span><span class="o">.</span><span class="n">train_stream</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start of experience: &quot;</span><span class="p">,</span> <span class="n">experience</span><span class="o">.</span><span class="n">current_experience</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Current Classes: &quot;</span><span class="p">,</span> <span class="n">experience</span><span class="o">.</span><span class="n">classes_in_this_experience</span><span class="p">)</span>

    <span class="c1"># train returns a dictionary which contains all the metric values</span>
    <span class="n">res</span> <span class="o">=</span> <span class="n">cl_strategy</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">experience</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training completed&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing accuracy on the whole test set&#39;</span><span class="p">)</span>
    <span class="c1"># test also returns a dictionary which contains all the metric values</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cl_strategy</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">test_stream</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz
Downloading http://yann.lecun.com/exdb/mnist/train-images-idx3-ubyte.gz to /root/.avalanche/data/mnist/MNIST/raw/train-images-idx3-ubyte.gz
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "c3922ac9ae2f4457a9dfc75b6e6dbfb3", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Extracting /root/.avalanche/data/mnist/MNIST/raw/train-images-idx3-ubyte.gz to /root/.avalanche/data/mnist/MNIST/raw

Downloading http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz
Downloading http://yann.lecun.com/exdb/mnist/train-labels-idx1-ubyte.gz to /root/.avalanche/data/mnist/MNIST/raw/train-labels-idx1-ubyte.gz
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "d23681ef255f41b0af7922fa794da80c", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Extracting /root/.avalanche/data/mnist/MNIST/raw/train-labels-idx1-ubyte.gz to /root/.avalanche/data/mnist/MNIST/raw

Downloading http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz
Downloading http://yann.lecun.com/exdb/mnist/t10k-images-idx3-ubyte.gz to /root/.avalanche/data/mnist/MNIST/raw/t10k-images-idx3-ubyte.gz
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "a4301fb5c7ac48a3ae474b21e609fb16", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Extracting /root/.avalanche/data/mnist/MNIST/raw/t10k-images-idx3-ubyte.gz to /root/.avalanche/data/mnist/MNIST/raw

Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz
Downloading http://yann.lecun.com/exdb/mnist/t10k-labels-idx1-ubyte.gz to /root/.avalanche/data/mnist/MNIST/raw/t10k-labels-idx1-ubyte.gz
</pre></div>
</div>
<script type="application/vnd.jupyter.widget-view+json">
{"model_id": "ab28a2655e004b5a8fe5866959f4313a", "version_major": 2, "version_minor": 0}
</script><div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Extracting /root/.avalanche/data/mnist/MNIST/raw/t10k-labels-idx1-ubyte.gz to /root/.avalanche/data/mnist/MNIST/raw
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/torchvision/datasets/mnist.py:498: UserWarning: The given NumPy array is not writeable, and PyTorch does not support non-writeable tensors. This means you can write to the underlying (supposedly non-writeable) NumPy array using the tensor. You may want to copy the array to protect its data or make it writeable before converting it to a tensor. This type of warning will be suppressed for the rest of this program. (Triggered internally at  /pytorch/torch/csrc/utils/tensor_numpy.cpp:180.)
  return torch.from_numpy(parsed.astype(m[2], copy=False)).view(*s)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting experiment...
Start of experience:  0
Current Classes:  [8, 9]
-- &gt;&gt; Start of training phase &lt;&lt; --
-- Starting training on experience 0 (Task 0) from train stream --
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/avalanche/training/plugins/evaluation.py:84: UserWarning: No benchmark provided to the evaluation plugin. Metrics may be computed on inconsistent portion of streams, use at your own risk.
  &quot;No benchmark provided to the evaluation plugin. &quot;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 24/24 [00:03&lt;00:00,  7.42it/s]
Epoch 0 ended.
	DiskUsage_Epoch/train_phase/train_stream/Task000 = 55536.4629
	DiskUsage_MB/train_phase/train_stream/Task000 = 55536.4629
	Loss_Epoch/train_phase/train_stream/Task000 = 1.2134
	Loss_MB/train_phase/train_stream/Task000 = 0.4104
	RunningTime_Epoch/train_phase/train_stream/Task000 = 0.0187
	Time_Epoch/train_phase/train_stream/Task000 = 3.2358
	Top1_Acc_Epoch/train_phase/train_stream/Task000 = 0.6629
	Top1_Acc_MB/train_phase/train_stream/Task000 = 0.9167
-- &gt;&gt; End of training phase &lt;&lt; --
Training completed
Computing accuracy on the whole test set
-- &gt;&gt; Start of eval phase &lt;&lt; --
-- Starting eval on experience 0 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 33.09it/s]
&gt; Eval on experience 0 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp000 = 97.1364
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp000 = 55541.0479
	Loss_Exp/eval_phase/test_stream/Task000/Exp000 = 0.3513
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp000 = 0.9460
-- Starting eval on experience 1 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 33.36it/s]
&gt; Eval on experience 1 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp001 = 96.5331
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp001 = 55541.4033
	Loss_Exp/eval_phase/test_stream/Task000/Exp001 = 5.0745
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp001 = 0.0000
-- Starting eval on experience 2 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 31.90it/s]
&gt; Eval on experience 2 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp002 = 96.5591
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp002 = 55541.7588
	Loss_Exp/eval_phase/test_stream/Task000/Exp002 = 4.7913
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp002 = 0.0000
-- Starting eval on experience 3 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 33.13it/s]
&gt; Eval on experience 3 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp003 = 98.3635
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp003 = 55542.1143
	Loss_Exp/eval_phase/test_stream/Task000/Exp003 = 5.1002
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp003 = 0.0000
-- Starting eval on experience 4 (Task 0) from test stream --
100%|██████████| 22/22 [00:00&lt;00:00, 33.22it/s]
&gt; Eval on experience 4 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp004 = 97.5704
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp004 = 55542.4697
	Loss_Exp/eval_phase/test_stream/Task000/Exp004 = 4.3829
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp004 = 0.0000
-- &gt;&gt; End of eval phase &lt;&lt; --
	ConfusionMatrix_Stream/eval_phase/test_stream = 
tensor([[  0,   0,   0,   0,   0,   0,   0,   0, 698, 282],
        [  0,   0,   0,   0,   0,   0,   0,   0, 980, 155],
        [  0,   0,   0,   0,   0,   0,   0,   0, 811, 221],
        [  0,   0,   0,   0,   0,   0,   0,   0, 885, 125],
        [  0,   0,   0,   0,   0,   0,   0,   0,  46, 936],
        [  0,   0,   0,   0,   0,   0,   0,   0, 683, 209],
        [  0,   0,   0,   0,   0,   0,   0,   0, 546, 412],
        [  0,   0,   0,   0,   0,   0,   0,   0,  59, 969],
        [  0,   0,   0,   0,   0,   0,   0,   0, 906,  68],
        [  0,   0,   0,   0,   0,   0,   0,   0,  39, 970]])
	DiskUsage_Stream/eval_phase/test_stream/Task000 = 55542.4697
	Loss_Stream/eval_phase/test_stream/Task000 = 3.9402
	StreamForgetting/eval_phase/test_stream = 0.0000
	Top1_Acc_Stream/eval_phase/test_stream/Task000 = 0.1876
Start of experience:  1
Current Classes:  [0, 3]
-- &gt;&gt; Start of training phase &lt;&lt; --
-- Starting training on experience 1 (Task 0) from train stream --
100%|██████████| 25/25 [00:02&lt;00:00,  8.63it/s]
Epoch 0 ended.
	DiskUsage_Epoch/train_phase/train_stream/Task000 = 55555.7471
	DiskUsage_MB/train_phase/train_stream/Task000 = 55555.7471
	Loss_Epoch/train_phase/train_stream/Task000 = 1.7890
	Loss_MB/train_phase/train_stream/Task000 = 0.3477
	RunningTime_Epoch/train_phase/train_stream/Task000 = 0.0053
	Time_Epoch/train_phase/train_stream/Task000 = 2.8992
	Top1_Acc_Epoch/train_phase/train_stream/Task000 = 0.5430
	Top1_Acc_MB/train_phase/train_stream/Task000 = 0.9259
-- &gt;&gt; End of training phase &lt;&lt; --
Training completed
Computing accuracy on the whole test set
-- &gt;&gt; Start of eval phase &lt;&lt; --
-- Starting eval on experience 0 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 33.90it/s]
&gt; Eval on experience 0 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp000 = 98.9710
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp000 = 55560.3320
	ExperienceForgetting/eval_phase/test_stream/Task000/Exp000 = 0.9460
	Loss_Exp/eval_phase/test_stream/Task000/Exp000 = 3.6450
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp000 = 0.0000
-- Starting eval on experience 1 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 33.57it/s]
&gt; Eval on experience 1 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp001 = 98.9385
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp001 = 55560.7549
	Loss_Exp/eval_phase/test_stream/Task000/Exp001 = 0.2300
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp001 = 0.9824
-- Starting eval on experience 2 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 33.19it/s]
&gt; Eval on experience 2 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp002 = 95.9209
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp002 = 55561.1104
	Loss_Exp/eval_phase/test_stream/Task000/Exp002 = 4.4834
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp002 = 0.0000
-- Starting eval on experience 3 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 34.57it/s]
&gt; Eval on experience 3 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp003 = 96.2455
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp003 = 55561.4658
	Loss_Exp/eval_phase/test_stream/Task000/Exp003 = 4.8591
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp003 = 0.0000
-- Starting eval on experience 4 (Task 0) from test stream --
100%|██████████| 22/22 [00:00&lt;00:00, 34.61it/s]
&gt; Eval on experience 4 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp004 = 96.6974
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp004 = 55561.8213
	Loss_Exp/eval_phase/test_stream/Task000/Exp004 = 4.0984
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp004 = 0.0000
-- &gt;&gt; End of eval phase &lt;&lt; --
	ConfusionMatrix_Stream/eval_phase/test_stream = 
tensor([[ 953,    0,    0,   27,    0,    0,    0,    0,    0,    0],
        [   0,    0,    0, 1135,    0,    0,    0,    0,    0,    0],
        [ 166,    0,    0,  866,    0,    0,    0,    0,    0,    0],
        [   8,    0,    0, 1002,    0,    0,    0,    0,    0,    0],
        [ 230,    0,    0,  752,    0,    0,    0,    0,    0,    0],
        [ 207,    0,    0,  685,    0,    0,    0,    0,    0,    0],
        [ 456,    0,    0,  502,    0,    0,    0,    0,    0,    0],
        [ 182,    0,    0,  846,    0,    0,    0,    0,    0,    0],
        [ 107,    0,    0,  867,    0,    0,    0,    0,    0,    0],
        [ 145,    0,    0,  864,    0,    0,    0,    0,    0,    0]])
	DiskUsage_Stream/eval_phase/test_stream/Task000 = 55561.8213
	Loss_Stream/eval_phase/test_stream/Task000 = 3.4615
	StreamForgetting/eval_phase/test_stream = 0.9460
	Top1_Acc_Stream/eval_phase/test_stream/Task000 = 0.1955
Start of experience:  2
Current Classes:  [6, 7]
-- &gt;&gt; Start of training phase &lt;&lt; --
-- Starting training on experience 2 (Task 0) from train stream --
100%|██████████| 25/25 [00:02&lt;00:00,  8.61it/s]
Epoch 0 ended.
	DiskUsage_Epoch/train_phase/train_stream/Task000 = 55579.1963
	DiskUsage_MB/train_phase/train_stream/Task000 = 55579.1963
	Loss_Epoch/train_phase/train_stream/Task000 = 2.0401
	Loss_MB/train_phase/train_stream/Task000 = 0.4385
	RunningTime_Epoch/train_phase/train_stream/Task000 = 0.0046
	Time_Epoch/train_phase/train_stream/Task000 = 2.9033
	Top1_Acc_Epoch/train_phase/train_stream/Task000 = 0.4663
	Top1_Acc_MB/train_phase/train_stream/Task000 = 0.9891
-- &gt;&gt; End of training phase &lt;&lt; --
Training completed
Computing accuracy on the whole test set
-- &gt;&gt; Start of eval phase &lt;&lt; --
-- Starting eval on experience 0 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 31.82it/s]
&gt; Eval on experience 0 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp000 = 93.7090
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp000 = 55579.7812
	ExperienceForgetting/eval_phase/test_stream/Task000/Exp000 = 0.9460
	Loss_Exp/eval_phase/test_stream/Task000/Exp000 = 3.0389
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp000 = 0.0000
-- Starting eval on experience 1 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 33.07it/s]
&gt; Eval on experience 1 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp001 = 94.9609
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp001 = 55580.2041
	ExperienceForgetting/eval_phase/test_stream/Task000/Exp001 = 0.8407
	Loss_Exp/eval_phase/test_stream/Task000/Exp001 = 1.7044
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp001 = 0.1417
-- Starting eval on experience 2 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 31.65it/s]
&gt; Eval on experience 2 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp002 = 97.1506
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp002 = 55580.6270
	Loss_Exp/eval_phase/test_stream/Task000/Exp002 = 0.3646
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp002 = 0.9879
-- Starting eval on experience 3 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 32.74it/s]
&gt; Eval on experience 3 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp003 = 95.1102
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp003 = 55580.9824
	Loss_Exp/eval_phase/test_stream/Task000/Exp003 = 3.7396
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp003 = 0.0000
-- Starting eval on experience 4 (Task 0) from test stream --
100%|██████████| 22/22 [00:00&lt;00:00, 32.90it/s]
&gt; Eval on experience 4 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp004 = 99.0728
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp004 = 55581.3379
	Loss_Exp/eval_phase/test_stream/Task000/Exp004 = 3.5576
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp004 = 0.0000
-- &gt;&gt; End of eval phase &lt;&lt; --
	ConfusionMatrix_Stream/eval_phase/test_stream = 
tensor([[ 202,    0,    0,    0,    0,    0,  715,   63,    0,    0],
        [   0,    0,    0,    0,    0,    0,  532,  603,    0,    0],
        [   0,    0,    0,    1,    0,    0,  844,  187,    0,    0],
        [   0,    0,    0,   80,    0,    0,  445,  485,    0,    0],
        [   0,    0,    0,    0,    0,    0,  364,  618,    0,    0],
        [   0,    0,    0,    0,    0,    0,  571,  321,    0,    0],
        [   1,    0,    0,    0,    0,    0,  951,    6,    0,    0],
        [   0,    0,    0,    0,    0,    0,   17, 1011,    0,    0],
        [   0,    0,    0,    0,    0,    0,  514,  460,    0,    0],
        [   0,    0,    0,    0,    0,    0,   78,  931,    0,    0]])
	DiskUsage_Stream/eval_phase/test_stream/Task000 = 55581.3379
	Loss_Stream/eval_phase/test_stream/Task000 = 2.4868
	StreamForgetting/eval_phase/test_stream = 0.8934
	Top1_Acc_Stream/eval_phase/test_stream/Task000 = 0.2244
Start of experience:  3
Current Classes:  [2, 5]
-- &gt;&gt; Start of training phase &lt;&lt; --
-- Starting training on experience 3 (Task 0) from train stream --
100%|██████████| 23/23 [00:02&lt;00:00,  8.16it/s]
Epoch 0 ended.
	DiskUsage_Epoch/train_phase/train_stream/Task000 = 55594.7129
	DiskUsage_MB/train_phase/train_stream/Task000 = 55594.7129
	Loss_Epoch/train_phase/train_stream/Task000 = 2.2599
	Loss_MB/train_phase/train_stream/Task000 = 1.0285
	RunningTime_Epoch/train_phase/train_stream/Task000 = 0.0054
	Time_Epoch/train_phase/train_stream/Task000 = 2.8168
	Top1_Acc_Epoch/train_phase/train_stream/Task000 = 0.2783
	Top1_Acc_MB/train_phase/train_stream/Task000 = 0.8417
-- &gt;&gt; End of training phase &lt;&lt; --
Training completed
Computing accuracy on the whole test set
-- &gt;&gt; Start of eval phase &lt;&lt; --
-- Starting eval on experience 0 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 31.29it/s]
&gt; Eval on experience 0 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp000 = 98.7804
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp000 = 55599.2979
	ExperienceForgetting/eval_phase/test_stream/Task000/Exp000 = 0.9460
	Loss_Exp/eval_phase/test_stream/Task000/Exp000 = 2.8417
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp000 = 0.0000
-- Starting eval on experience 1 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 32.53it/s]
&gt; Eval on experience 1 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp001 = 99.5918
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp001 = 55599.7207
	ExperienceForgetting/eval_phase/test_stream/Task000/Exp001 = 0.9422
	Loss_Exp/eval_phase/test_stream/Task000/Exp001 = 2.1893
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp001 = 0.0402
-- Starting eval on experience 2 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 33.11it/s]
&gt; Eval on experience 2 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp002 = 99.0851
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp002 = 55600.1436
	ExperienceForgetting/eval_phase/test_stream/Task000/Exp002 = 0.5891
	Loss_Exp/eval_phase/test_stream/Task000/Exp002 = 1.4655
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp002 = 0.3988
-- Starting eval on experience 3 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 34.34it/s]
&gt; Eval on experience 3 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp003 = 95.5144
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp003 = 55600.5664
	Loss_Exp/eval_phase/test_stream/Task000/Exp003 = 0.9197
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp003 = 0.8732
-- Starting eval on experience 4 (Task 0) from test stream --
100%|██████████| 22/22 [00:00&lt;00:00, 31.97it/s]
&gt; Eval on experience 4 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp004 = 92.8602
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp004 = 55600.9219
	Loss_Exp/eval_phase/test_stream/Task000/Exp004 = 3.2216
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp004 = 0.0000
-- &gt;&gt; End of eval phase &lt;&lt; --
	ConfusionMatrix_Stream/eval_phase/test_stream = 
tensor([[  80,    0,  761,    0,    0,  138,    0,    1,    0,    0],
        [   0,    0,  953,    0,    0,  182,    0,    0,    0,    0],
        [   0,    0, 1026,    0,    0,    3,    1,    2,    0,    0],
        [   0,    0,  799,    0,    0,  197,    0,   14,    0,    0],
        [   0,    0,  766,    0,    0,  199,    0,   17,    0,    0],
        [   0,    0,  234,    0,    0,  654,    0,    4,    0,    0],
        [   0,    0,  939,    0,    0,   19,    0,    0,    0,    0],
        [   0,    0,  210,    0,    0,   26,    0,  792,    0,    0],
        [   0,    0,  808,    0,    0,  160,    0,    6,    0,    0],
        [   0,    0,  528,    0,    0,  235,    0,  246,    0,    0]])
	DiskUsage_Stream/eval_phase/test_stream/Task000 = 55600.9219
	Loss_Stream/eval_phase/test_stream/Task000 = 2.1492
	StreamForgetting/eval_phase/test_stream = 0.8258
	Top1_Acc_Stream/eval_phase/test_stream/Task000 = 0.2552
Start of experience:  4
Current Classes:  [1, 4]
-- &gt;&gt; Start of training phase &lt;&lt; --
-- Starting training on experience 4 (Task 0) from train stream --
100%|██████████| 26/26 [00:03&lt;00:00,  8.27it/s]
Epoch 0 ended.
	DiskUsage_Epoch/train_phase/train_stream/Task000 = 55618.2969
	DiskUsage_MB/train_phase/train_stream/Task000 = 55618.2969
	Loss_Epoch/train_phase/train_stream/Task000 = 1.9867
	Loss_MB/train_phase/train_stream/Task000 = 0.6203
	RunningTime_Epoch/train_phase/train_stream/Task000 = 0.0047
	Time_Epoch/train_phase/train_stream/Task000 = 3.1416
	Top1_Acc_Epoch/train_phase/train_stream/Task000 = 0.4263
	Top1_Acc_MB/train_phase/train_stream/Task000 = 0.9762
-- &gt;&gt; End of training phase &lt;&lt; --
Training completed
Computing accuracy on the whole test set
-- &gt;&gt; Start of eval phase &lt;&lt; --
-- Starting eval on experience 0 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 31.39it/s]
&gt; Eval on experience 0 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp000 = 97.4487
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp000 = 55618.8818
	ExperienceForgetting/eval_phase/test_stream/Task000/Exp000 = 0.9460
	Loss_Exp/eval_phase/test_stream/Task000/Exp000 = 2.8442
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp000 = 0.0000
-- Starting eval on experience 1 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 31.17it/s]
&gt; Eval on experience 1 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp001 = 97.3740
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp001 = 55619.3047
	ExperienceForgetting/eval_phase/test_stream/Task000/Exp001 = 0.8236
	Loss_Exp/eval_phase/test_stream/Task000/Exp001 = 2.1273
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp001 = 0.1588
-- Starting eval on experience 2 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 31.81it/s]
&gt; Eval on experience 2 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp002 = 93.8625
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp002 = 55619.7275
	ExperienceForgetting/eval_phase/test_stream/Task000/Exp002 = 0.8525
	Loss_Exp/eval_phase/test_stream/Task000/Exp002 = 1.9454
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp002 = 0.1354
-- Starting eval on experience 3 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 33.23it/s]
&gt; Eval on experience 3 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp003 = 96.6959
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp003 = 55620.1504
	ExperienceForgetting/eval_phase/test_stream/Task000/Exp003 = 0.5769
	Loss_Exp/eval_phase/test_stream/Task000/Exp003 = 1.6908
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp003 = 0.2963
-- Starting eval on experience 4 (Task 0) from test stream --
100%|██████████| 22/22 [00:00&lt;00:00, 32.99it/s]
&gt; Eval on experience 4 (Task 0) from test stream ended.
	CPUUsage_Exp/eval_phase/test_stream/Task000/Exp004 = 97.3922
	DiskUsage_Exp/eval_phase/test_stream/Task000/Exp004 = 55620.5732
	Loss_Exp/eval_phase/test_stream/Task000/Exp004 = 0.5641
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp004 = 0.9792
-- &gt;&gt; End of eval phase &lt;&lt; --
	ConfusionMatrix_Stream/eval_phase/test_stream = 
tensor([[ 313,   17,  300,    0,  245,  105,    0,    0,    0,    0],
        [   0, 1135,    0,    0,    0,    0,    0,    0,    0,    0],
        [   0,  427,  403,    0,  200,    1,    0,    1,    0,    0],
        [   0,  729,   98,    3,  135,   40,    0,    5,    0,    0],
        [   0,   43,    1,    0,  938,    0,    0,    0,    0,    0],
        [   1,  349,   30,    0,  342,  167,    0,    3,    0,    0],
        [   1,  151,   29,    0,  775,    2,    0,    0,    0,    0],
        [   0,  197,    9,    0,  553,    0,    0,  269,    0,    0],
        [   0,  550,    2,    0,  420,    2,    0,    0,    0,    0],
        [   0,   81,    5,    0,  923,    0,    0,    0,    0,    0]])
	DiskUsage_Stream/eval_phase/test_stream/Task000 = 55620.5732
	Loss_Stream/eval_phase/test_stream/Task000 = 1.8184
	StreamForgetting/eval_phase/test_stream = 0.7998
	Top1_Acc_Stream/eval_phase/test_stream/Task000 = 0.3228
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="dataloading-memory-buffers-and-replay">
<h2>Dataloading, Memory Buffers, and Replay<a class="headerlink" href="#dataloading-memory-buffers-and-replay" title="Permalink to this headline">¶</a></h2>
<p>Avalanche provides several components that help you to balance data loading and implement rehearsal strategies.</p>
<p><strong>Dataloaders</strong> are used to provide balancing between groups (e.g. tasks/classes/experiences). This is especially useful when you have unbalanced data.</p>
<p><strong>Buffers</strong> are used to store data from the previous experiences. They are dynamic datasets with a fixed maximum size, and they can be updated with new data continuously.</p>
<p>Finally, <strong>Replay</strong> strategies implement rehearsal by using Avalanche’s plugin system. Most rehearsal strategies use a custom dataloader to balance the buffer with the current experience and a buffer that is updated for each experience.</p>
<div class="section" id="dataloaders">
<h3>Dataloaders<a class="headerlink" href="#dataloaders" title="Permalink to this headline">¶</a></h3>
<p>Avalanche dataloaders are simple iterators, located under <code class="docutils literal notranslate"><span class="pre">avalanche.benchmarks.utils.data_loader</span></code>. Their interface is equivalent to pytorch’s dataloaders. For example, <code class="docutils literal notranslate"><span class="pre">GroupBalancedDataLoader</span></code> takes a sequence of datasets and iterates over them by providing balanced mini-batches, where the number of samples is split equally among groups. Internally, it instantiate a <code class="docutils literal notranslate"><span class="pre">DataLoader</span></code> for each separate group. More specialized dataloaders exist such as <code class="docutils literal notranslate"><span class="pre">TaskBalancedDataLoader</span></code>.</p>
<p>All the dataloaders accept keyword arguments (<code class="docutils literal notranslate"><span class="pre">**kwargs</span></code>) that are passed directly to the dataloaders for each group.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">benchmark</span> <span class="o">=</span> <span class="n">SplitMNIST</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">return_task_id</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">dl</span> <span class="o">=</span> <span class="n">GroupBalancedDataLoader</span><span class="p">([</span><span class="n">exp</span><span class="o">.</span><span class="n">dataset</span> <span class="k">for</span> <span class="n">exp</span> <span class="ow">in</span> <span class="n">benchmark</span><span class="o">.</span><span class="n">train_stream</span><span class="p">],</span> <span class="n">batch_size</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dl</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 0, 0, 0, 1, 1, 1, 1, 2, 2, 2, 2, 3, 3, 3, 3, 4, 4, 4, 4]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="memory-buffers">
<h3>Memory Buffers<a class="headerlink" href="#memory-buffers" title="Permalink to this headline">¶</a></h3>
<p>Memory buffers store data up to a maximum capacity, and they implement policies to select which data to store and which the to remove when the buffer is full. They are available in the module <code class="docutils literal notranslate"><span class="pre">avalanche.training.storage_policy</span></code>. The base class is the <code class="docutils literal notranslate"><span class="pre">ExemplarsBuffer</span></code>, which implements two methods:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">update(strategy)</span></code> - given the strategy’s state it updates the buffer (using the data in <code class="docutils literal notranslate"><span class="pre">strategy.experience.dataset</span></code>).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">resize(strategy,</span> <span class="pre">new_size)</span></code> - updates the maximum size and updates the buffer accordingly.</p></li>
</ul>
<p>The data can be access using the attribute <code class="docutils literal notranslate"><span class="pre">buffer</span></code>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">benchmark</span> <span class="o">=</span> <span class="n">SplitMNIST</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="n">return_task_id</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">storage_p</span> <span class="o">=</span> <span class="n">ReservoirSamplingBuffer</span><span class="p">(</span><span class="n">max_size</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max buffer size: </span><span class="si">{</span><span class="n">storage_p</span><span class="o">.</span><span class="n">max_size</span><span class="si">}</span><span class="s2">, current size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">storage_p</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Max buffer size: 30, current size: 0
</pre></div>
</div>
</div>
</div>
<p>At first, the buffer is empty. We can update it with data from a new experience.</p>
<p>Notice that we use a <code class="docutils literal notranslate"><span class="pre">SimpleNamespace</span></code> because we want to use the buffer standalone, without instantiating an Avalanche strategy. Reservoir sampling requires only the <code class="docutils literal notranslate"><span class="pre">experience</span></code> from the strategy’s state.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">strategy_state</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span><span class="n">experience</span><span class="o">=</span><span class="n">benchmark</span><span class="o">.</span><span class="n">train_stream</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">storage_p</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">strategy_state</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max buffer size: </span><span class="si">{</span><span class="n">storage_p</span><span class="o">.</span><span class="n">max_size</span><span class="si">}</span><span class="s2">, current size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">storage_p</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;class targets: </span><span class="si">{</span><span class="n">storage_p</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">targets</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Max buffer size: 30, current size: 30
class targets: [0, 7, 0, 0, 0, 7, 0, 7, 7, 0, 7, 0, 0, 7, 7, 7, 7, 0, 0, 0, 7, 0, 7, 7, 7, 7, 0, 0, 0, 0]

Max buffer size: 30, current size: 30
class targets: [0, 7, 0, 0, 0, 7, 6, 0, 1, 6, 1, 7, 1, 7, 1, 1, 6, 0, 7, 0, 1, 1, 0, 7, 6, 6, 7, 6, 6, 1]

Max buffer size: 30, current size: 30
class targets: [0, 4, 4, 7, 0, 4, 4, 0, 4, 4, 0, 2, 7, 6, 2, 0, 1, 6, 2, 1, 7, 1, 4, 7, 2, 2, 1, 2, 1, 6]

Max buffer size: 30, current size: 30
class targets: [0, 4, 4, 7, 0, 4, 4, 0, 4, 4, 9, 9, 0, 2, 7, 6, 2, 0, 1, 6, 2, 1, 7, 1, 4, 9, 7, 2, 2, 5]

Max buffer size: 30, current size: 30
class targets: [0, 8, 3, 4, 4, 3, 7, 0, 4, 4, 0, 4, 4, 8, 9, 8, 9, 0, 2, 7, 6, 2, 0, 1, 6, 2, 8, 1, 7, 3]
</pre></div>
</div>
</div>
</div>
<p>Notice after each update some samples are substituted with new data. Reservoir sampling select these samples randomly.</p>
<p>Avalanche offers many more storage policies. For example, <code class="docutils literal notranslate"><span class="pre">ParametricBuffer</span></code> is a buffer split into several groups according to the <code class="docutils literal notranslate"><span class="pre">groupby</span></code> parameters (<code class="docutils literal notranslate"><span class="pre">None</span></code>, ‘class’, ‘task’, ‘experience’), and according to an optional <code class="docutils literal notranslate"><span class="pre">ExemplarsSelectionStrategy</span></code> (random selection is the default choice).</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">storage_p</span> <span class="o">=</span> <span class="n">ParametricBuffer</span><span class="p">(</span>
    <span class="n">max_size</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span>
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;class&#39;</span><span class="p">,</span>
    <span class="n">selection_strategy</span><span class="o">=</span><span class="n">RandomExemplarsSelectionStrategy</span><span class="p">()</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max buffer size: </span><span class="si">{</span><span class="n">storage_p</span><span class="o">.</span><span class="n">max_size</span><span class="si">}</span><span class="s2">, current size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">storage_p</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">strategy_state</span> <span class="o">=</span> <span class="n">SimpleNamespace</span><span class="p">(</span><span class="n">experience</span><span class="o">=</span><span class="n">benchmark</span><span class="o">.</span><span class="n">train_stream</span><span class="p">[</span><span class="n">i</span><span class="p">])</span>
    <span class="n">storage_p</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">strategy_state</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Max buffer size: </span><span class="si">{</span><span class="n">storage_p</span><span class="o">.</span><span class="n">max_size</span><span class="si">}</span><span class="s2">, current size: </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">storage_p</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;class targets: </span><span class="si">{</span><span class="n">storage_p</span><span class="o">.</span><span class="n">buffer</span><span class="o">.</span><span class="n">targets</span><span class="si">}</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Max buffer size: 30, current size: 0
Max buffer size: 30, current size: 30
class targets: [0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7, 7]

Max buffer size: 30, current size: 30
class targets: [0, 0, 0, 0, 0, 0, 0, 0, 7, 7, 7, 7, 7, 7, 7, 1, 1, 1, 1, 1, 1, 1, 1, 6, 6, 6, 6, 6, 6, 6]

Max buffer size: 30, current size: 30
class targets: [0, 0, 0, 0, 0, 7, 7, 7, 7, 7, 1, 1, 1, 1, 1, 6, 6, 6, 6, 6, 4, 4, 4, 4, 4, 2, 2, 2, 2, 2]

Max buffer size: 30, current size: 30
class targets: [0, 0, 0, 0, 7, 7, 7, 1, 1, 1, 1, 6, 6, 6, 6, 4, 4, 4, 4, 2, 2, 2, 2, 5, 5, 5, 5, 9, 9, 9]

Max buffer size: 30, current size: 30
class targets: [0, 0, 0, 7, 7, 7, 1, 1, 1, 6, 6, 6, 4, 4, 4, 2, 2, 2, 5, 5, 5, 9, 9, 9, 3, 3, 3, 8, 8, 8]
</pre></div>
</div>
</div>
</div>
<p>The advantage of using grouping buffers is that you get a balanced rehearsal buffer. You can even access the groups separately with the <code class="docutils literal notranslate"><span class="pre">buffer_groups</span></code> attribute. Combined with balanced dataloaders, you can ensure that the mini-batches stay balanced during training.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">storage_p</span><span class="o">.</span><span class="n">buffer_groups</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;(group </span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2">) -&gt; size </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">v</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>(group 0) -&gt; size 3
(group 7) -&gt; size 3
(group 1) -&gt; size 3
(group 6) -&gt; size 3
(group 4) -&gt; size 3
(group 2) -&gt; size 3
(group 5) -&gt; size 3
(group 9) -&gt; size 3
(group 3) -&gt; size 3
(group 8) -&gt; size 3
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">datas</span> <span class="o">=</span> <span class="p">[</span><span class="n">v</span><span class="o">.</span><span class="n">buffer</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">storage_p</span><span class="o">.</span><span class="n">buffer_groups</span><span class="o">.</span><span class="n">values</span><span class="p">()]</span>
<span class="n">dl</span> <span class="o">=</span> <span class="n">GroupBalancedDataLoader</span><span class="p">(</span><span class="n">datas</span><span class="p">)</span>

<span class="k">for</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">dl</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">y</span><span class="o">.</span><span class="n">tolist</span><span class="p">())</span>
    <span class="k">break</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[0, 7, 1, 6, 4, 2, 5, 9, 3, 8]
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="replay-plugins">
<h3>Replay Plugins<a class="headerlink" href="#replay-plugins" title="Permalink to this headline">¶</a></h3>
<p>Avalanche’s strategy plugins can be used to update the rehearsal buffer and set the dataloader. This allows to easily implement replay strategies:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">avalanche.training</span> <span class="kn">import</span> <span class="n">Naive</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">class</span> <span class="nc">CustomReplay</span><span class="p">(</span><span class="n">StrategyPlugin</span><span class="p">):</span>
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">storage_policy</span><span class="p">):</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span> <span class="o">=</span> <span class="n">storage_policy</span>

    <span class="k">def</span> <span class="nf">before_training_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy</span><span class="p">,</span>
                            <span class="n">num_workers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">shuffle</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
                            <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Here we set the dataloader. &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">buffer</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="c1"># first experience. We don&#39;t use the buffer, no need to change</span>
            <span class="c1"># the dataloader.</span>
            <span class="k">return</span>

        <span class="c1"># replay dataloader samples mini-batches from the memory and current</span>
        <span class="c1"># data separately and combines them together.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Override the dataloader.&quot;</span><span class="p">)</span>
        <span class="n">strategy</span><span class="o">.</span><span class="n">dataloader</span> <span class="o">=</span> <span class="n">ReplayDataLoader</span><span class="p">(</span>
            <span class="n">strategy</span><span class="o">.</span><span class="n">adapted_dataset</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">buffer</span><span class="p">,</span>
            <span class="n">oversample_small_tasks</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
            <span class="n">num_workers</span><span class="o">=</span><span class="n">num_workers</span><span class="p">,</span>
            <span class="n">batch_size</span><span class="o">=</span><span class="n">strategy</span><span class="o">.</span><span class="n">train_mb_size</span><span class="p">,</span>
            <span class="n">shuffle</span><span class="o">=</span><span class="n">shuffle</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">after_training_exp</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">strategy</span><span class="p">:</span> <span class="s2">&quot;BaseStrategy&quot;</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; We update the buffer after the experience.</span>
<span class="sd">            You can use a different callback to update the buffer in a different place</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Buffer update.&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">storage_policy</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">strategy</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>And of course, we can use the plugin to train our continual model</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">scenario</span> <span class="o">=</span> <span class="n">SplitMNIST</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SimpleMLP</span><span class="p">(</span><span class="n">num_classes</span><span class="o">=</span><span class="n">scenario</span><span class="o">.</span><span class="n">n_classes</span><span class="p">)</span>
<span class="n">storage_p</span> <span class="o">=</span> <span class="n">ParametricBuffer</span><span class="p">(</span>
    <span class="n">max_size</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
    <span class="n">groupby</span><span class="o">=</span><span class="s1">&#39;class&#39;</span><span class="p">,</span>
    <span class="n">selection_strategy</span><span class="o">=</span><span class="n">RandomExemplarsSelectionStrategy</span><span class="p">()</span>
<span class="p">)</span>

<span class="c1"># choose some metrics and evaluation method</span>
<span class="n">interactive_logger</span> <span class="o">=</span> <span class="n">InteractiveLogger</span><span class="p">()</span>

<span class="n">eval_plugin</span> <span class="o">=</span> <span class="n">EvaluationPlugin</span><span class="p">(</span>
    <span class="n">accuracy_metrics</span><span class="p">(</span><span class="n">experience</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">stream</span><span class="o">=</span><span class="kc">True</span><span class="p">),</span>
    <span class="n">loggers</span><span class="o">=</span><span class="p">[</span><span class="n">interactive_logger</span><span class="p">])</span>

<span class="c1"># CREATE THE STRATEGY INSTANCE (NAIVE)</span>
<span class="n">cl_strategy</span> <span class="o">=</span> <span class="n">Naive</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">Adam</span><span class="p">(</span><span class="n">model</span><span class="o">.</span><span class="n">parameters</span><span class="p">(),</span> <span class="n">lr</span><span class="o">=</span><span class="mf">0.001</span><span class="p">),</span>
                    <span class="n">CrossEntropyLoss</span><span class="p">(),</span>
                    <span class="n">train_mb_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">train_epochs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eval_mb_size</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
                    <span class="n">plugins</span><span class="o">=</span><span class="p">[</span><span class="n">CustomReplay</span><span class="p">(</span><span class="n">storage_p</span><span class="p">)],</span>
                    <span class="n">evaluator</span><span class="o">=</span><span class="n">eval_plugin</span>
                    <span class="p">)</span>

<span class="c1"># TRAINING LOOP</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Starting experiment...&#39;</span><span class="p">)</span>
<span class="n">results</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">experience</span> <span class="ow">in</span> <span class="n">scenario</span><span class="o">.</span><span class="n">train_stream</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Start of experience &quot;</span><span class="p">,</span> <span class="n">experience</span><span class="o">.</span><span class="n">current_experience</span><span class="p">)</span>
    <span class="n">cl_strategy</span><span class="o">.</span><span class="n">train</span><span class="p">(</span><span class="n">experience</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Training completed&#39;</span><span class="p">)</span>

    <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;Computing accuracy on the whole test set&#39;</span><span class="p">)</span>
    <span class="n">results</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">cl_strategy</span><span class="o">.</span><span class="n">eval</span><span class="p">(</span><span class="n">scenario</span><span class="o">.</span><span class="n">test_stream</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting experiment...
Start of experience  0
-- &gt;&gt; Start of training phase &lt;&lt; --
-- Starting training on experience 0 (Task 0) from train stream --
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>/usr/local/lib/python3.7/dist-packages/avalanche/training/plugins/evaluation.py:84: UserWarning: No benchmark provided to the evaluation plugin. Metrics may be computed on inconsistent portion of streams, use at your own risk.
  &quot;No benchmark provided to the evaluation plugin. &quot;
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>100%|██████████| 114/114 [00:03&lt;00:00, 30.17it/s]
Epoch 0 ended.
Buffer update.
-- &gt;&gt; End of training phase &lt;&lt; --
Training completed
Computing accuracy on the whole test set
-- &gt;&gt; Start of eval phase &lt;&lt; --
-- Starting eval on experience 0 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 37.94it/s]
&gt; Eval on experience 0 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp000 = 0.9865
-- Starting eval on experience 1 (Task 0) from test stream --
100%|██████████| 22/22 [00:00&lt;00:00, 36.46it/s]
&gt; Eval on experience 1 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp001 = 0.0000
-- Starting eval on experience 2 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 35.71it/s]
&gt; Eval on experience 2 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp002 = 0.0000
-- Starting eval on experience 3 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 35.72it/s]
&gt; Eval on experience 3 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp003 = 0.0000
-- Starting eval on experience 4 (Task 0) from test stream --
100%|██████████| 21/21 [00:00&lt;00:00, 37.04it/s]
&gt; Eval on experience 4 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp004 = 0.0000
-- &gt;&gt; End of eval phase &lt;&lt; --
	Top1_Acc_Stream/eval_phase/test_stream/Task000 = 0.1898
Start of experience  1
-- &gt;&gt; Start of training phase &lt;&lt; --
Override the dataloader.
-- Starting training on experience 1 (Task 0) from train stream --
100%|██████████| 254/254 [00:09&lt;00:00, 27.97it/s]
Epoch 0 ended.
Buffer update.
-- &gt;&gt; End of training phase &lt;&lt; --
Training completed
Computing accuracy on the whole test set
-- &gt;&gt; Start of eval phase &lt;&lt; --
-- Starting eval on experience 0 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 37.32it/s]
&gt; Eval on experience 0 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp000 = 0.9636
-- Starting eval on experience 1 (Task 0) from test stream --
100%|██████████| 22/22 [00:00&lt;00:00, 37.23it/s]
&gt; Eval on experience 1 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp001 = 0.9962
-- Starting eval on experience 2 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 36.32it/s]
&gt; Eval on experience 2 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp002 = 0.0000
-- Starting eval on experience 3 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 35.76it/s]
&gt; Eval on experience 3 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp003 = 0.0000
-- Starting eval on experience 4 (Task 0) from test stream --
100%|██████████| 21/21 [00:00&lt;00:00, 36.65it/s]
&gt; Eval on experience 4 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp004 = 0.0000
-- &gt;&gt; End of eval phase &lt;&lt; --
	Top1_Acc_Stream/eval_phase/test_stream/Task000 = 0.3961
Start of experience  2
-- &gt;&gt; Start of training phase &lt;&lt; --
Override the dataloader.
-- Starting training on experience 2 (Task 0) from train stream --
100%|██████████| 240/240 [00:08&lt;00:00, 28.11it/s]
Epoch 0 ended.
Buffer update.
-- &gt;&gt; End of training phase &lt;&lt; --
Training completed
Computing accuracy on the whole test set
-- &gt;&gt; Start of eval phase &lt;&lt; --
-- Starting eval on experience 0 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 38.21it/s]
&gt; Eval on experience 0 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp000 = 0.8971
-- Starting eval on experience 1 (Task 0) from test stream --
100%|██████████| 22/22 [00:00&lt;00:00, 36.54it/s]
&gt; Eval on experience 1 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp001 = 0.9868
-- Starting eval on experience 2 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 36.04it/s]
&gt; Eval on experience 2 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp002 = 0.9885
-- Starting eval on experience 3 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 36.35it/s]
&gt; Eval on experience 3 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp003 = 0.0000
-- Starting eval on experience 4 (Task 0) from test stream --
100%|██████████| 21/21 [00:00&lt;00:00, 36.76it/s]
&gt; Eval on experience 4 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp004 = 0.0000
-- &gt;&gt; End of eval phase &lt;&lt; --
	Top1_Acc_Stream/eval_phase/test_stream/Task000 = 0.5782
Start of experience  3
-- &gt;&gt; Start of training phase &lt;&lt; --
Override the dataloader.
-- Starting training on experience 3 (Task 0) from train stream --
100%|██████████| 238/238 [00:08&lt;00:00, 28.66it/s]
Epoch 0 ended.
Buffer update.
-- &gt;&gt; End of training phase &lt;&lt; --
Training completed
Computing accuracy on the whole test set
-- &gt;&gt; Start of eval phase &lt;&lt; --
-- Starting eval on experience 0 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 38.57it/s]
&gt; Eval on experience 0 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp000 = 0.8960
-- Starting eval on experience 1 (Task 0) from test stream --
100%|██████████| 22/22 [00:00&lt;00:00, 38.30it/s]
&gt; Eval on experience 1 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp001 = 0.9702
-- Starting eval on experience 2 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 39.00it/s]
&gt; Eval on experience 2 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp002 = 0.8705
-- Starting eval on experience 3 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 38.11it/s]
&gt; Eval on experience 3 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp003 = 0.9797
-- Starting eval on experience 4 (Task 0) from test stream --
100%|██████████| 21/21 [00:00&lt;00:00, 38.46it/s]
&gt; Eval on experience 4 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp004 = 0.0000
-- &gt;&gt; End of eval phase &lt;&lt; --
	Top1_Acc_Stream/eval_phase/test_stream/Task000 = 0.7437
Start of experience  4
-- &gt;&gt; Start of training phase &lt;&lt; --
Override the dataloader.
-- Starting training on experience 4 (Task 0) from train stream --
100%|██████████| 243/243 [00:08&lt;00:00, 28.22it/s]
Epoch 0 ended.
Buffer update.
-- &gt;&gt; End of training phase &lt;&lt; --
Training completed
Computing accuracy on the whole test set
-- &gt;&gt; Start of eval phase &lt;&lt; --
-- Starting eval on experience 0 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 38.18it/s]
&gt; Eval on experience 0 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp000 = 0.8446
-- Starting eval on experience 1 (Task 0) from test stream --
100%|██████████| 22/22 [00:00&lt;00:00, 38.21it/s]
&gt; Eval on experience 1 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp001 = 0.9414
-- Starting eval on experience 2 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 36.86it/s]
&gt; Eval on experience 2 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp002 = 0.8956
-- Starting eval on experience 3 (Task 0) from test stream --
100%|██████████| 20/20 [00:00&lt;00:00, 37.85it/s]
&gt; Eval on experience 3 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp003 = 0.8902
-- Starting eval on experience 4 (Task 0) from test stream --
100%|██████████| 21/21 [00:00&lt;00:00, 37.72it/s]
&gt; Eval on experience 4 (Task 0) from test stream ended.
	Top1_Acc_Exp/eval_phase/test_stream/Task000/Exp004 = 0.9730
-- &gt;&gt; End of eval phase &lt;&lt; --
	Top1_Acc_Stream/eval_phase/test_stream/Task000 = 0.9099
</pre></div>
</div>
</div>
</div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "sparsh-ai/incremental-learning",
            ref: "main",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./."
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
        
            



<div class='prev-next-bottom'>
    
    <div id="prev">
        <a class="left-prev" href="T664430_Incremental_Stochastic_Gradient_Descent.html" title="previous page">
            <i class="prevnext-label fas fa-angle-left"></i>
            <div class="prevnext-info">
                <p class="prevnext-label">previous</p>
                <p class="prevnext-title">Incremental Stochastic Gradient Descent</p>
            </div>
        </a>
    </div>
     <div id="next">
        <a class="right-next" href="T392297_Lambda_Learner_for_Incremental_Learning_using_GLMix_models.html" title="next page">
            <div class="prevnext-info">
                <p class="prevnext-label">next</p>
                <p class="prevnext-title">Lambda Learner for Incremental Learning using GLMix models</p>
            </div>
            <i class="prevnext-label fas fa-angle-right"></i>
        </a>
     </div>

</div>
        
        </div>
    </div>
    <footer class="footer">
    <div class="container">
      <p>
        
          By Sparsh A.<br/>
        
            &copy; Copyright 2021.<br/>
      </p>
    </div>
  </footer>
</main>


      </div>
    </div>
  
  <script src="_static/js/index.1c5a1a01449ed65a7b51.js"></script>

  
  </body>
</html>